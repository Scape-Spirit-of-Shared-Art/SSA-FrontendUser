<div class="place-page">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading place...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <p class="error-message">{{ error }}</p>
    <button (click)="loadPlaceData(place?.id || 0)" class="retry-button">Try Again</button>
  </div>

  <!-- Place Content -->
  <div *ngIf="place && !loading && !error">
    <!-- Hero Section -->
    <section class="hero-section">
      <img 
        [src]="getPlaceImage()" 
        [alt]="place.name" 
        class="hero-image"
      />
      <h1 class="place-title">{{ place.name }}</h1>
      <svg 
        class="place-favorite-icon" 
        [class.active]="isPlaceFavorite"
        (click)="togglePlaceFavorite()"
        width="24" 
        height="22" 
        viewBox="0 0 24 22" 
        fill="none" 
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M12.5 5.67998C10.1667 0.203146 2 0.786478 2 7.78652C2 14.7865 12.5 20.62 12.5 20.62C12.5 20.62 23 14.7865 23 7.78652C23 0.786478 14.8333 0.203146 12.5 5.67998Z" stroke="#FEF5E6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </section>

    <!-- Description -->
    <section class="description-section">
      <p class="place-description">{{ place.bio }}</p>
    </section>

    <!-- Local Events -->
    <section class="local-events-section">
      <h2 class="section-title">local events</h2>
      <div class="events-scroll">
        <div *ngIf="events.length === 0" class="no-events">
          <p>No events available at this place.</p>
        </div>
        
        <div 
          class="event-card" 
          *ngFor="let event of events" 
          (click)="onEventClick(event)"
        >
          <div class="event-card-wrapper">
            <img [src]="getEventImage(event)" [alt]="event.name" class="event-image" />
            <div class="event-date">
              <span class="event-day">{{ formatEventDate(event.date).day }}</span>
              <span class="event-month">{{ formatEventDate(event.date).month }}</span>
            </div>
            <div class="event-info">
              <h3 class="event-title">{{ event.name }}</h3>
              <div class="event-location">
                <svg class="location-icon" width="6" height="11" viewBox="0 0 6 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3.5 10C3.5 10.2761 3.27614 10.5 3 10.5C2.72386 10.5 2.5 10.2761 2.5 10L3 10L3.5 10ZM3 5.66667C1.52724 5.66667 0.333333 4.47276 0.333333 3C0.333333 1.52724 1.52724 0.333333 3 0.333333C4.47276 0.333333 5.66667 1.52724 5.66667 3C5.66667 4.47276 4.47276 5.66667 3 5.66667ZM3 10L2.5 10L2.5 3L3 3L3.5 3L3.5 10L3 10Z" fill="#FEF5E6"/>
                </svg>
                <span>{{ event.address }}</span>
              </div>
            </div>
            <svg 
              class="favorite-icon" 
              [class.active]="isEventFavorite(event)"
              (click)="toggleEventFavorite(event); $event.stopPropagation()"
              width="12" 
              height="11" 
              viewBox="0 0 12 11" 
              fill="none" 
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M6.25 2.83999C5.08333 0.101573 1 0.393239 1 3.89326C1 7.39327 6.25 10.31 6.25 10.31C6.25 10.31 11.5 7.39327 11.5 3.89326C11.5 0.393239 7.41667 0.101573 6.25 2.83999Z" stroke="#FEF5E6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Live Crowd -->
    <section class="live-crowd-section">
      <h2 class="section-title">Live Crowd</h2>
      
      <!-- No Floor Plan Data -->
      <div *ngIf="floors.length === 0" class="no-floor-plan">
        <p>No floor plan data available for this place.</p>
      </div>
      
      <!-- Floor Selection (if multiple floors) -->
      <div *ngIf="floors.length > 1" class="floor-selector">
        <button 
          *ngFor="let floor of floors; let i = index"
          class="floor-button"
          [class.active]="i === selectedFloorIndex"
          (click)="selectFloor(i)"
        >
          {{ floor.name }}
        </button>
      </div>
      
      <!-- Dynamic Floor Plan -->
      <div *ngIf="floors.length > 0" class="floor-plan">
        <div 
          *ngFor="let room of getRoomsForFloor(floors[selectedFloorIndex])" 
          class="floor-section"
          [style.left.px]="getRoomPosition(room).x"
          [style.top.px]="getRoomPosition(room).y"
          [style.width.px]="getRoomPosition(room).w"
          [style.height.px]="getRoomPosition(room).h"
        >
          <span class="section-number">{{ room.label || room.id }}</span>
          <svg 
            *ngIf="getOccupancyLevel(room) !== 'low'"
            class="occupancy-icon"
            [class.occupancy-center]="room.label === 1"
            width="10" 
            height="9" 
            viewBox="0 0 10 9" 
            fill="none" 
            xmlns="http://www.w3.org/2000/svg"
          >
            <path 
              fill-rule="evenodd" 
              clip-rule="evenodd" 
              d="M4.29881 1.7823C3.5718 1.7823 2.98244 2.29993 2.98244 2.93846C2.98244 3.57699 3.5718 4.09461 4.29881 4.09461C5.02583 4.09461 5.61519 3.57699 5.61519 2.93846C5.61519 2.29993 5.02583 1.7823 4.29881 1.7823ZM5.49704 4.31699C5.96896 4.00009 6.27337 3.5005 6.27337 2.93846C6.27337 1.98067 5.38933 1.20422 4.29881 1.20422C3.20829 1.20422 2.32425 1.98067 2.32425 2.93846C2.32425 3.5005 2.62867 4.00009 3.10059 4.31699C2.76969 4.44555 2.46527 4.62748 2.20448 4.85653C2.0031 5.0334 1.83369 5.23314 1.69956 5.44879C1.45204 5.84674 1.55299 6.2525 1.83173 6.53941C2.10008 6.81562 2.52995 6.985 2.98244 6.985H5.61519C6.06768 6.985 6.49755 6.81562 6.76589 6.53942C7.04464 6.2525 7.14558 5.84674 6.89807 5.44879C6.76394 5.23315 6.59453 5.0334 6.39315 4.85653C6.13235 4.62748 5.82793 4.44555 5.49704 4.31699ZM4.29881 4.67269C3.68785 4.67269 3.1019 4.88586 2.66989 5.2653C2.51324 5.40288 2.3815 5.55821 2.27718 5.72593C2.17616 5.88835 2.20875 6.03689 2.33242 6.16419C2.46649 6.30219 2.70792 6.40693 2.98244 6.40693H5.61519C5.8897 6.40693 6.13114 6.30219 6.26521 6.16419C6.38888 6.03689 6.42147 5.88835 6.32045 5.72593C6.21613 5.55821 6.08439 5.40288 5.92774 5.2653C5.49572 4.88586 4.90978 4.67269 4.29881 4.67269Z" 
              [attr.fill]="getOccupancyLevel(room) === 'high' ? '#9A0000' : '#009800'"
            />
          </svg>
        </div>
      </div>
    </section>

    <!-- Schedule -->
    <section class="schedule-section">
      <h2 class="section-title">Schedule</h2>
      <div class="schedule-details">
        <p>Monday - Friday: {{ place.monday_friday }}</p>
        <p>Saturday: {{ place.saturday }}</p>
        <p>Sunday: {{ place.sunday }}</p>
      </div>
    </section>

    <!-- Contact -->
    <section class="contact-section">
      <h2 class="section-heading">CONTACT</h2>
      <div class="contact-info">
        <!-- Website -->
        <div class="contact-item" *ngIf="place.website">
          <img src="/Vector.png" alt="Vector" class="contact-vector">
          <a 
            [href]="place.website" 
            target="_blank" 
            class="contact-link underline"
            (click)="onWebsiteClick()"
          >
            website
          </a>
        </div>

        <!-- Email -->
        <div class="contact-item" *ngIf="place.email">
          <img src="/Vector-1.png" alt="Vector 1" class="contact-vector">
          <span class="contact-text">{{ place.email }}</span>
        </div>

        <!-- Phone -->
        <div class="contact-item" *ngIf="place.phone_number">
          <img src="/Vector-2.png" alt="Vector 2" class="contact-vector">
          <span class="contact-text">{{ place.phone_number }}</span>
        </div>

        <!-- Address -->
        <div class="contact-item" *ngIf="place.address">
          <img src="/Vector-3.png" alt="Vector 3" class="contact-vector">
          <div class="contact-text address">
            <span>{{ place.address }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Get Tickets Button -->
    <section class="cta-section" *ngIf="place.website && place.categories?.includes('CITY_TREASURES')">
      <button class="get-tickets-btn" (click)="onGetTickets()">
        Get tickets
      </button>
    </section>
  </div>

  <!-- Navbar -->
  <app-navbar></app-navbar>
</div>
